{% extends "layout.html" %}

{% block content %}
    <h2>Reports</h2>

    <h3>Weekly Averages (last 30 days)</h3>
    <p>Average Weekly Income: <span class="income">{{ "%.2f"|format(avg_income) }}</span></p>
    <p>Average Weekly Expense: <span class="expense">{{ "%.2f"|format(avg_expense) }}</span></p>

    <hr>

    <h3>Budget Report</h3>
    <form action="{{ url_for('reports') }}" method="POST">
        <label>Set Monthly Budget:</label>
        <input type="number" name="budget" step="0.01" min="0.01" 
               value="{{ budget_data.budget if budget_data }}">
        <button type="submit">Check Budget</button>
    </form>
    
    {% if budget_data %}
        <p>Your Budget: {{ "%.2f"|format(budget_data.budget) }}</p>
        <p>Total Expense: {{ "%.2f"|format(budget_data.total_expense) }}</p>
        {% if budget_data.is_over %}
            <p style="color: red; font-weight: bold;">
                ⚠️ WARNING: Expense exceeded the budget!
            </p>
        {% else %}
             <p style="color: green; font-weight: bold;">
                ✅ Expense is within the budget.
            </p>
        {% endif %}
    {% endif %}

    <hr>
    
    <h3>Category Ratios</h3>
    
    <h4>Expense Ratios</h4>
    <ul>
        {% for item in expense_ratios %}
            <li>{{ item.category }}: {{ "%.1f"|format(item.percent) }}%</li>
        {% else %}
            <li>No expenses recorded.</li>
        {% endfor %}
    </ul>

    <h4>Income Ratios</h4>
    <ul>
        {% for item in income_ratios %}
            <li>{{ item.category }}: {{ "%.1f"|format(item.percent) }}%</li>
        {% else %}
            <li>No income recorded.</li>
        {% endfor %}
    </ul>

{% endblock %}