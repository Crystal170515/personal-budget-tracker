{% extends "base.html" %}
{% block content %}
<h2 class="page-title">Your Transactions</h2>

<div class="card mb">
  <p>Current Balance: <strong>{{ "{:,.2f}".format(balance) }}</strong></p>
</div>

<form method="get" class="card form-inline mb">
  <div>
    <label>Month</label>
    <input type="month" name="month" class="month-input-dark" value="{{ month if month else '' }}">
  </div>
  <div>
    <label>Category</label>
    <select name="category">
      <option value="all">All</option>
      {% for c in income_categories %}
        <option value="{{ c }}" {% if category==c %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
      {% for c in expense_categories %}
        <option value="{{ c }}" {% if category==c %}selected{% endif %}>{{ c }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <button type="submit">Filter</button>
  </div>
</form>

<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Category</th>
        <th>Amount</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
    {% for t in transactions %}
    <tr class="{{ 'income-row' if t['type']=='income' else 'expense-row' }}">
      <td>{{ t['date'] }}</td>
      <td>{{ t['type'] }}</td>
      <td>{{ t['category'] }}</td>

      {# ----- Amount column ----- #}
      <td>
        {% set thb = t['amount_thb'] if t['amount_thb'] is not none else t['amount'] %}
        {% if t['type'] == 'income' %}
          +{{ "{:,.2f}".format(thb) }}
        {% else %}
          -{{ "{:,.2f}".format(thb) }}
        {% endif %}
        <span> THB</span>

        {% if t['currency'] and t['currency'] != 'THB' %}
          <br>
          <small>( {{ "{:,.2f}".format(t['amount']) }} {{ t['currency'] }} â†’ {{ "{:,.2f}".format(t['amount_thb']) }} THB )</small>
        {% endif %}
      </td>

      <td>{{ t['description'] }}</td>
    </tr>
    {% endfor %}
    </tbody>

  </table>
</div>
{% endblock %}
